<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Software Estimation Manager</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/themes/vscode-dark.css">
    <!-- NUOVO: CSS per configurazione gerarchica -->
    <link rel="stylesheet" href="styles/hierarchical-config.css">
    <link rel="stylesheet" href="styles/project-phases.css">
    <link rel="stylesheet" href="styles/storage-config.css">
    <link rel="stylesheet" href="styles/configuration-scrollable.css">
    <link rel="stylesheet" href="styles/categories-config.css">
    <link rel="stylesheet" href="styles/teams-config.css">
    <link rel="stylesheet" href="styles/calculations.css">
    <link rel="stylesheet" href="styles/version-history.css">
    <link rel="stylesheet" href="styles/capacity.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div id="app">
    <!-- Custom Title Bar -->
    <div class="custom-title-bar">
        <div class="title-bar-left">
            <div class="app-info">
                <div class="app-icon">
                    <i class="fas fa-calculator"></i>
                </div>
                <span class="app-title">Software Estimation Manager</span>
            </div>
        </div>

        <div class="title-bar-center">
            <div class="title-project-info">
                <span id="title-project-name">New Project</span>
                <span id="project-status" class="unsaved">‚óè</span>
            </div>
        </div>

        <div class="title-bar-right">
            <div class="window-controls">
                <button class="window-control-btn minimize" onclick="window.electronAPI?.minimize()" title="Minimize">
                    <i class="fas fa-window-minimize"></i>
                </button>
                <button class="window-control-btn maximize" onclick="window.electronAPI?.maximize()" title="Maximize/Restore">
                    <i class="fas fa-window-maximize"></i>
                </button>
                <button class="window-control-btn close" onclick="window.electronAPI?.close()" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- VSCode-style Sidebar with Icon Bar and Expandable Panels -->
        <div class="vscode-sidebar-container">
            <!-- Icon Bar (Always Visible) -->
            <nav class="icon-sidebar">
                <!-- Collapse Toggle (at top) -->
                <div class="icon-item collapse-toggle" title="Toggle Sidebar">
                    <i class="fas fa-angles-left"></i>
                </div>
                
                <div class="icon-sections">
                    <div class="icon-item" data-panel="projects" title="Projects">
                        <i class="fas fa-folder-open"></i>
                    </div>
                    <div class="icon-item" data-panel="capacity" title="Capacity Planning">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="icon-item" data-panel="configuration" title="Configuration">
                        <i class="fas fa-cog"></i>
                    </div>
                </div>
            </nav>

            <!-- Expandable Panels -->
            <div class="expandable-panels">
                
                <!-- Projects Panel -->
                <div class="sidebar-panel" id="projects-panel" data-panel="projects">
                    <div class="panel-header">
                        <h3>Projects</h3>
                    </div>

                    <div class="panel-navigation">
                        <!-- Main Projects Section -->
                        <div class="nav-section has-children active" data-section="projects">
                            <div class="nav-item">
                                <i class="fas fa-folder-open"></i>
                                <span>Projects</span>
                                <div class="project-status-indicator no-project" id="nav-project-status"></div>
                                <button class="nav-toggle" id="projects-toggle">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>

                            <div class="nav-children" id="projects-children">
                                <div class="nav-child disabled" data-section="features">
                                    <i class="fas fa-list-ul"></i>
                                    <span>Features Management</span>
                                </div>

                                <div class="nav-child disabled" data-section="phases">
                                    <i class="fas fa-project-diagram"></i>
                                    <span>Project Phases</span>
                                </div>

                                <div class="nav-child disabled" data-section="calculations">
                                    <i class="fas fa-chart-bar"></i>
                                    <span>Calculations</span>
                                </div>

                                <div class="nav-child disabled" data-section="assumptions">
                                    <i class="fas fa-clipboard-list"></i>
                                    <span>Assumptions</span>
                                </div>

                                <div class="nav-child disabled" data-section="history">
                                    <i class="fas fa-history"></i>
                                    <span>Version History</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Projects Specific Actions -->
                    <div class="panel-footer">
                        <button class="btn btn-primary" id="save-btn">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <button class="btn btn-secondary" id="export-btn">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>

                <!-- Capacity Planning Panel -->
                <div class="sidebar-panel" id="capacity-panel" data-panel="capacity">
                    <div class="panel-header">
                        <h3>Capacity Planning</h3>
                    </div>

                    <div class="panel-navigation">
                        <!-- Main Capacity Section -->
                        <div class="nav-section has-children active" data-section="capacity">
                            <div class="nav-item">
                                <i class="fas fa-users"></i>
                                <span>Capacity Planning</span>
                                <button class="nav-toggle expanded" id="capacity-toggle">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>

                            <div class="nav-children expanded" id="capacity-children">
                                <div class="nav-capacity-child" data-section="resource-overview">
                                    <i class="fas fa-chart-pie"></i>
                                    <span>Resource Capacity Overview</span>
                                </div>

                                <div class="nav-capacity-child" data-section="capacity-timeline">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>Capacity Planning Timeline</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Capacity Planning Actions -->
                    <div class="panel-footer">
                        <button class="btn btn-primary" id="capacity-save-btn">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <input type="file" id="capacity-file-input" accept=".json" style="display: none;">
                        <button class="btn btn-secondary" id="capacity-load-btn">
                            <i class="fas fa-upload"></i> Load
                        </button>
                    </div>
                </div>

                <!-- Configuration Panel -->
                <div class="sidebar-panel" id="configuration-panel" data-panel="configuration">
                    <div class="panel-header">
                        <h3>Configuration</h3>
                    </div>

                    <div class="panel-navigation">
                        <!-- Configuration has no sub-sections, just direct access -->
                        <div class="nav-section active" data-section="configuration">
                            <div class="nav-item">
                                <i class="fas fa-cog"></i>
                                <span>Configuration</span>
                            </div>
                        </div>
                    </div>

                    <!-- No specific actions for Configuration -->
                    <div class="panel-footer">
                        <!-- No save/export actions for configuration -->
                    </div>
                </div>

            </div>
        </div>

        <!-- Main Content Area -->
        <main class="content-area">
            <!-- Projects Page -->
            <div id="projects-page" class="page active">
                <div class="page-header">
                    <h2>Project Manager</h2>
                    <div class="page-actions">
                        <button class="btn btn-primary" id="new-project-btn">
                            <i class="fas fa-plus"></i> New Project
                        </button>
                        <button class="btn btn-secondary" id="load-project-btn">
                            <i class="fas fa-folder-open"></i> Load Project
                        </button>
                    </div>
                </div>

                <!-- Two Column Layout -->
                <div class="project-manager-layout">
                    <!-- Left Column -->
                    <div class="project-manager-left">
                        <!-- Current Project Info -->
                        <div class="current-project-section">
                            <div class="section-header">
                                <h3>Current Project</h3>
                            </div>
                            <div class="current-project-card" id="current-project-card">
                                <div class="project-info">
                                    <h4 id="current-project-name">No Project Loaded</h4>
                                    <div class="project-details">
                                        <span class="project-detail">
                                            <i class="fas fa-calendar"></i>
                                            <span id="current-project-created">-</span>
                                        </span>
                                        <span class="project-detail">
                                            <i class="fas fa-edit"></i>
                                            <span id="current-project-modified">-</span>
                                        </span>
                                        <span class="project-detail">
                                            <i class="fas fa-code-branch"></i>
                                            <span id="current-project-version">-</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="project-actions">
                                    <button class="btn btn-small btn-primary" id="save-current-project-btn" disabled>
                                        <i class="fas fa-save"></i> Save
                                    </button>
                                    <button class="btn btn-small btn-secondary" id="close-current-project-btn" disabled>
                                        <i class="fas fa-times"></i> Close
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Projects -->
                        <div class="recent-projects-section">
                            <div class="section-header">
                                <h3>Recent Projects</h3>
                                <button class="btn btn-small btn-secondary" id="clear-recent-btn">
                                    <i class="fas fa-trash"></i> Clear Recent
                                </button>
                            </div>
                            <div id="recent-projects-list" class="projects-list">
                                <!-- Recent projects will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="project-manager-right">
                        <!-- Saved Projects -->
                        <div class="saved-projects-section">
                            <div class="section-header">
                                <h3>Saved Projects</h3>
                                <button class="btn btn-small btn-secondary" id="refresh-projects-btn">
                                    <i class="fas fa-sync"></i> Refresh
                                </button>
                            </div>
                            <div id="saved-projects-list" class="projects-list">
                                <!-- Saved projects will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features Management Page -->
            <div id="features-page" class="page">
                <div class="page-header">
                    <h2>Features Management</h2>
                    <div class="page-actions">
                        <button class="btn btn-primary" id="add-feature-btn">
                            <i class="fas fa-plus"></i> Add Feature
                        </button>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="search-bar">
                    <div class="search-group">
                        <label>Search:</label>
                        <input type="text" id="search-input" placeholder="Search features...">
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-bar">
                    <div class="filter-group">
                        <label>Category:</label>
                        <select id="category-filter">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Feature Type:</label>
                        <select id="feature-type-filter">
                            <option value="">All Feature Types</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Supplier:</label>
                        <select id="supplier-filter">
                            <option value="">All Suppliers</option>
                        </select>
                    </div>
                </div>

                <!-- Features Table -->
                <div class="table-container">
                    <table id="features-table" class="data-table expandable-table">
                        <thead>
                        <tr>
                            <th class="expand-col"></th>
                            <th data-sort="id">ID <i class="fas fa-sort"></i></th>
                            <th data-sort="description">Description <i class="fas fa-sort"></i></th>
                            <th data-sort="supplier">Supplier <i class="fas fa-sort"></i></th>
                            <th data-sort="realManDays">Real MD <i class="fas fa-sort"></i></th>
                            <th data-sort="manDays">Calc MD <i class="fas fa-sort"></i></th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody id="features-tbody">
                        <!-- Features will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Feature Summary -->
                <div class="summary-bar">
                    <div class="summary-item">
                        <label>Total Features:</label>
                        <span id="total-features">0</span>
                    </div>
                    <div class="summary-item">
                        <label>Total Man Days:</label>
                        <span id="total-man-days">0</span>
                    </div>
                    <div class="summary-item">
                        <label>Average per Feature:</label>
                        <span id="average-man-days">0</span>
                    </div>
                    <div class="summary-item">
                        <label>Filtered Man Days:</label>
                        <span id="filtered-man-days">0</span>
                    </div>
                    <div class="summary-item coverage-item">
                        <label>Coverage:</label>
                        <div class="coverage-controls">
                            <input type="number" id="coverage-value" min="0" step="0.1" class="coverage-input">
                            <button type="button" id="coverage-reset-btn" class="coverage-reset-btn" title="Reset to 30% of Total Man Days">
                                <i class="fas fa-undo"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Project Phases Page -->
            <div id="phases-page" class="page">
                <div class="page-header">
                    <h2>Project Phases Configuration</h2>
                    <div class="page-actions">
                        <button class="btn btn-secondary" onclick="window.refreshPhasesFromFeatures()">
                            <i class="fas fa-sync"></i> Refresh from Features
                        </button>
                        <button class="btn btn-primary" onclick="window.app?.phasesManager?.exportPhases()">
                            <i class="fas fa-download"></i> Export Phases
                        </button>
                    </div>
                </div>
                <div class="phases-content">
                    <div class="phases-loading">
                        <div class="spinner"></div>
                        <span>Loading phases configuration...</span>
                    </div>
                </div>
            </div>

            <!-- Calculations Page -->
            <div id="calculations-page" class="page">
                <div class="page-header">
                    <h2>Calculations Dashboard</h2>
                </div>
                <div class="calculations-content">
                    <!-- Calculations content will be populated by CalculationsManager -->
                </div>
            </div>

            <!-- Assumptions Page -->
            <div id="assumptions-page" class="page">
                <div class="page-header">
                    <h2>Project Assumptions</h2>
                    <div class="page-actions">
                        <button class="btn btn-primary" id="add-assumption-btn">
                            <i class="fas fa-plus"></i> Add Assumption
                        </button>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="search-bar">
                    <div class="search-group">
                        <label>Search:</label>
                        <input type="text" id="assumptions-search-input" placeholder="Search assumptions...">
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-bar">
                    <div class="filter-group">
                        <label>Type:</label>
                        <select id="assumption-type-filter">
                            <option value="">All Types</option>
                            <option value="Technical">Technical</option>
                            <option value="Business">Business</option>
                            <option value="Resource">Resource</option>
                            <option value="Timeline">Timeline</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Impact:</label>
                        <select id="assumption-impact-filter">
                            <option value="">All Impacts</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                </div>

                <!-- Assumptions Table -->
                <div class="table-container">
                    <table id="assumptions-table" class="data-table">
                        <thead>
                        <tr>
                            <th data-sort="id">ID <i class="fas fa-sort"></i></th>
                            <th data-sort="description">Description <i class="fas fa-sort"></i></th>
                            <th data-sort="type">Type <i class="fas fa-sort"></i></th>
                            <th data-sort="impact">Impact <i class="fas fa-sort"></i></th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody id="assumptions-tbody">
                        <!-- Assumptions will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Assumptions Summary -->
                <div class="summary-bar">
                    <div class="summary-item">
                        <label>Total Assumptions:</label>
                        <span id="total-assumptions">0</span>
                    </div>
                    <div class="summary-item">
                        <label>High Impact:</label>
                        <span id="high-impact-assumptions">0</span>
                    </div>
                    <div class="summary-item">
                        <label>Medium Impact:</label>
                        <span id="medium-impact-assumptions">0</span>
                    </div>
                    <div class="summary-item">
                        <label>Low Impact:</label>
                        <span id="low-impact-assumptions">0</span>
                    </div>
                </div>
            </div>

            <!-- Configuration Page -->
            <div id="configuration-page" class="page">
                <div class="page-header">
                    <h2>Configuration</h2>
                    <p class="page-description">Manage global and project-specific configuration settings</p>
                </div>
                
                <!-- Configuration Content -->
                <div class="config-content">
                    <!-- Suppliers Configuration -->
                    <div id="suppliers-config-tab" class="config-tab-content active">
                        <div class="suppliers-config-container">
                            <!-- Suppliers content will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Internal Resources Configuration -->
                    <div id="internal-resources-config-tab" class="config-tab-content">
                        <div class="resources-config-container">
                            <!-- Internal resources content will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Categories Configuration -->
                    <div id="categories-config-tab" class="config-tab-content">
                        <div class="categories-config-wrapper">
                            <!-- Categories content will be populated by CategoriesConfigManager -->
                        </div>
                    </div>
                </div>
            </div>


            <!-- Version History Page -->
            <div id="history-page" class="page">
                <div class="page-header">
                    <h2>Version History</h2>
                </div>
                <div class="history-content">
                    <p>Version history will be implemented here...</p>
                </div>
            </div>

            <!-- Resource Capacity Overview Page -->
            <div id="resource-overview-page" class="page">
                <div class="page-header">
                    <h2>üìä Resource Capacity Overview</h2>
                    <div class="page-actions">
                        <button class="btn btn-secondary" id="export-overview-btn">
                            <i class="fas fa-download"></i> Export Overview
                        </button>
                    </div>
                </div>

                <!-- Resource overview content will be dynamically rendered here -->
                <div id="resource-overview-content" class="capacity-overview-content">
                    <div class="loading-message">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading resource capacity overview...</p>
                    </div>
                </div>
            </div>

            <!-- Capacity Planning Timeline Page -->
            <div id="capacity-timeline-page" class="page">
                <div class="page-header">
                    <h2>üìÖ Capacity Planning Timeline</h2>
                    <div class="page-actions">
                        <button class="btn btn-primary" id="add-timeline-assignment-btn">
                            <i class="fas fa-plus"></i> Add Assignment
                        </button>
                        <button class="btn btn-secondary" id="export-timeline-btn">
                            <i class="fas fa-download"></i> Export Timeline
                        </button>
                    </div>
                </div>

                <!-- Timeline content will be dynamically rendered here -->
                <div id="capacity-timeline-content" class="capacity-timeline-content">
                    <div class="loading-message">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading capacity planning timeline...</p>
                    </div>
                </div>
            </div>

            <!-- Legacy Capacity Page (will be deprecated) -->
            <div id="capacity-page" class="page">
                <div class="page-header">
                    <h2>üìä Capacity Planning</h2>
                    <div class="page-actions">
                        <!-- Actions removed -->
                    </div>
                </div>

                <!-- Capacity content will be dynamically rendered here -->
                <div id="capacity-content" class="capacity-main-content">
                    <div class="loading-message">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading capacity planning...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-left">
            <span id="status-message">Ready</span>
        </div>
        <div class="status-right">
            <span id="last-saved">Last saved: Never</span>
        </div>
    </div>
</div>

<!-- All modals remain the same... -->

<!-- Modal for New Project -->
<div id="new-project-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create New Project</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form id="new-project-form">
                <div class="form-group">
                    <label for="project-code">Project Code:</label>
                    <input type="text" id="project-code" name="code" class="validation-tooltip required" required
                           placeholder="e.g. PJ-001"
                           pattern="[A-Z0-9\-_]+"
                           title="Only uppercase letters, numbers, hyphens and underscores allowed">
                    <small class="form-help">Unique identifier for the project (uppercase, numbers, - and _ only)</small>
                </div>
                <div class="form-group">
                    <label for="project-name">Project Name:</label>
                    <input type="text" id="project-name" name="name" class="validation-tooltip required" required
                           placeholder="e.g. Customer Portal Development"
                           maxlength="100">
                    <small class="form-help">Descriptive name for the project</small>
                </div>
                <div class="form-group">
                    <label for="project-description">Description (Optional):</label>
                    <textarea id="project-description" name="description"
                              placeholder="Brief description of the project..."
                              rows="3" maxlength="500"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancel-new-project-btn">Cancel</button>
            <button type="submit" class="btn btn-primary" id="create-project-btn">Create Project</button>
        </div>
    </div>
</div>

<!-- Modal for Project Loading -->
<div id="project-load-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Load Project</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="load-options">
                <div class="load-option">
                    <h4><i class="fas fa-file-upload"></i> Load from File</h4>
                    <p>Select a JSON project file from your computer</p>
                    <input type="file" id="project-file-input" accept=".json" style="display: none;">
                    <button class="btn btn-primary" id="select-file-btn">
                        <i class="fas fa-folder-open"></i> Choose File
                    </button>
                    <div id="selected-file-info" class="file-info" style="display: none;">
                        <i class="fas fa-file"></i>
                        <span id="selected-file-name"></span>
                        <span id="selected-file-size"></span>
                    </div>
                </div>

                <div class="load-option">
                    <h4><i class="fas fa-history"></i> Recent Projects</h4>
                    <div id="modal-recent-projects" class="recent-projects-modal">
                        <!-- Recent projects in modal -->
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancel-load-btn">Cancel</button>
            <button type="button" class="btn btn-primary" id="load-selected-project-btn" disabled>Load Project</button>
        </div>
    </div>
</div>

<!-- Modal for Feature Form -->
<div id="feature-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-title" class="modal-title">Add Feature</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form id="feature-form">
                <div class="form-group">
                    <label for="feature-id">ID:</label>
                    <input type="text" id="feature-id" name="id" class="validation-tooltip required" required>
                </div>
                <div class="form-group">
                    <label for="feature-description">Description:</label>
                    <textarea id="feature-description" name="description" class="validation-tooltip required" required rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="feature-category">Category:</label>
                    <select id="feature-category" name="category" class="validation-tooltip required" required>
                        <option value="">Select Category</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="feature-type">Feature Type:</label>
                    <select id="feature-type" name="featureType">
                        <option value="">Select Feature Type</option>
                    </select>
                    <small class="form-help">Choose a feature type to auto-populate estimated man days</small>
                </div>
                <div class="form-group">
                    <label for="feature-supplier">Supplier:</label>
                    <select id="feature-supplier" name="supplier" class="validation-tooltip required" required>
                        <option value="">Select Supplier</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="feature-real-man-days">Real Man Days:</label>
                    <input type="number" id="feature-real-man-days" name="realManDays" min="0.1" step="0.1" class="validation-tooltip required" required>
                    <small class="form-help">Actual effort needed without considering expertise level</small>
                </div>
                <div class="form-group">
                    <label for="feature-expertise">Expertise (%):</label>
                    <input type="number" id="feature-expertise" name="expertise" min="1" max="100" step="1" value="100" required>
                    <small class="form-help">Team expertise level (100% = fully experienced, 50% = less experienced)</small>
                </div>
                <div class="form-group">
                    <label for="feature-risk-margin">Risk Margin (%):</label>
                    <input type="number" id="feature-risk-margin" name="riskMargin" min="0" max="100" step="1" value="10" required>
                    <small class="form-help">Risk buffer to account for unexpected issues (0% = no buffer, 20% = high risk)</small>
                </div>
                <div class="form-group calculated-field">
                    <label for="feature-calculated-man-days">Calculated Man Days:</label>
                    <input type="number" id="feature-calculated-man-days" name="manDays" readonly>
                    <small class="form-help">Calculated: Real Man Days √ó (100 + Risk Margin) √∑ Expertise</small>
                </div>
                <div class="form-group">
                    <label for="feature-notes">Notes:</label>
                    <textarea id="feature-notes" name="notes" rows="2"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary btn-cancel" id="cancel-feature-btn">Cancel</button>
            <button type="submit" class="btn btn-primary btn-submit" id="save-feature-btn">Save</button>
        </div>
    </div>
</div>

<!-- Modal for Assumption Form -->
<div id="assumption-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="assumption-modal-title" class="modal-title">Add Assumption</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form id="assumption-form">
                <div class="form-group">
                    <label for="assumption-id">ID:</label>
                    <input type="text" id="assumption-id" name="id" class="validation-tooltip required" required>
                </div>
                <div class="form-group">
                    <label for="assumption-description">Description:</label>
                    <textarea id="assumption-description" name="description" class="validation-tooltip required" required rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="assumption-type">Type:</label>
                    <select id="assumption-type" name="type" class="validation-tooltip required" required>
                        <option value="">Select Type</option>
                        <option value="Technical">Technical</option>
                        <option value="Business">Business</option>
                        <option value="Resource">Resource</option>
                        <option value="Timeline">Timeline</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assumption-impact">Impact:</label>
                    <select id="assumption-impact" name="impact" class="validation-tooltip required" required>
                        <option value="">Select Impact</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assumption-notes">Notes:</label>
                    <textarea id="assumption-notes" name="notes" rows="3"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary btn-cancel" id="cancel-assumption-btn">Cancel</button>
            <button type="submit" class="btn btn-primary btn-submit" id="save-assumption-btn">Save</button>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="overlay">
    <div class="spinner"></div>
    <p>Loading...</p>
</div>

<!-- Notification Container -->
<div id="notifications" class="notifications-container"></div>

<!-- Scripts - FIXED LOADING ORDER -->
<!-- Base classes MUST load first -->
<script src="js/utils/base-component.js"></script>
<script src="js/utils/modal-manager.js"></script>
<script src="js/utils/helpers.js"></script>

<!-- Additional utilities -->
<script src="js/utils/error-handler.js"></script>
<script src="js/utils/performance-optimizer.js"></script>
<script src="js/utils/loading-helpers.js"></script>
<script src="js/utils/state-selectors.js"></script>

<!-- State Management -->
<script>
// Load Zustand library with fallbacks, then load app store
(function() {
    function loadScript(src, callback) {
        const script = document.createElement('script');
        script.src = src;
        script.onload = callback;
        script.onerror = () => {
            console.warn('Failed to load from:', src);
            callback(false);
        };
        document.head.appendChild(script);
    }

    function loadAppStore() {
        loadScript('js/store/app-store.js', (success) => {
            if (success) {
                console.log('App Store loaded successfully');
                // Ensure store is available before other components try to access it
                if (window.appStore) {
                    console.log('Store verified and available');
                    // Dispatch a custom event to let components know store is ready
                    window.dispatchEvent(new CustomEvent('storeReady'));
                } else {
                    console.error('Store not available after loading');
                }
            } else {
                console.error('Failed to load app store');
            }
        });
    }

    // Create a simplified store implementation
    console.log('Creating simplified state store');
    window.zustand = {
        createStore: (storeInitializer) => {
            let state = {};
            const listeners = new Set();
            
            const setState = (partial, replace) => {
                const nextState = replace ? partial : { ...state, ...partial };
                if (nextState !== state) {
                    const previousState = state;
                    state = nextState;
                    listeners.forEach((listener) => listener(state, previousState));
                }
            };
            
            const getState = () => state;
            
            const subscribe = (listener) => {
                listeners.add(listener);
                return () => listeners.delete(listener);
            };
            
            const destroy = () => listeners.clear();
            
            // Initialize the state
            state = storeInitializer(setState, getState);
            
            return {
                getState,
                setState,
                subscribe,
                destroy
            };
        }
    };
    
    console.log('Simplified store created, loading app store');
    loadAppStore();
})();
</script>

<!-- Data layer -->
<script src="js/data-manager.js"></script>

<!-- UI components (no dependencies on other managers) -->
<script src="js/components/notification-manager.js"></script>
<script src="js/components/modal.js"></script>
<script src="js/components/scroll-manager.js"></script>
<script src="js/components/global-loading-indicator.js"></script>

<!-- Configuration system (depends on data-manager) -->
<script src="js/components/configuration-ui-manager.js"></script>

<!-- Configuration system (depends on data-manager) -->
<script src="js/components/storage-config-manager.js"></script>

<!-- Configuration system (depends on data-manager) -->
<script src="js/components/supplier-config-manager.js"></script>

<!-- Configuration system (depends on data-manager) -->
<script src="js/components/internal-resources-config-manager.js"></script>

<!-- Default Configuration Manager (loads from external config files) -->
<script src="js/components/default-config-manager.js"></script>

<!-- Configuration system (depends on data-manager) -->
<script src="js/components/configuration-manager.js"></script>

<!-- Categories management (depends on configuration-manager) -->
<script src="js/components/categories-config-manager.js"></script>
<script src="js/components/teams-config-manager.js"></script>

<!-- Feature management (depends on data-manager and configuration-manager) -->
<script src="js/components/feature-manager.js"></script>

<!-- Assumptions management (depends on data-manager) -->
<script src="js/components/assumptions-manager.js"></script>

<!-- Calculations management (depends on data-manager and configuration-manager) -->
<script src="js/components/calculations-manager.js"></script>

<!-- Capacity planning components -->
<script src="js/components/team-manager.js"></script>
<script src="js/components/working-days-calculator.js"></script>
<script src="js/components/auto-distribution.js"></script>

<!-- Capacity management - NOTE: capacity-manager.js file doesn't exist, commenting out to prevent 404 error -->
<!-- <script src="js/components/capacity-manager.js"></script> -->

<!-- Navigation (depends on configuration-manager) -->
<script src="js/components/navigation.js"></script>

<!-- Project management (depends on other managers) -->
<script src="js/components/project-manager.js"></script>
<script src="js/components/project-phases-manager.js"></script>

<!-- Version management (depends on other managers) -->
<script src="js/components/version-manager.js"></script>

<!-- ExcelJS library for Excel export with styling support -->
<script>
// Try to load ExcelJS library with multiple fallbacks
(function() {
    function loadScript(src, callback) {
        const script = document.createElement('script');
        script.src = src;
        script.onload = callback;
        script.onerror = () => {
            console.warn('Failed to load ExcelJS from:', src);
            callback(false);
        };
        document.head.appendChild(script);
    }

    // Try CDN first for ExcelJS
    loadScript('https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.min.js', (success) => {
        if (success) {
            console.log('ExcelJS loaded from CDN');
            return;
        }
        
        // Fallback to alternative CDN
        loadScript('https://unpkg.com/exceljs@4.4.0/dist/exceljs.min.js', (success) => {
            if (success) {
                console.log('ExcelJS loaded from alternative CDN');
            } else {
                console.error('Failed to load ExcelJS library from all sources');
                // Create a mock ExcelJS object to prevent errors
                window.ExcelJS = {
                    Workbook: function() {
                        this.creator = '';
                        this.lastModifiedBy = '';
                        this.created = new Date();
                        this.modified = new Date();
                        this.addWorksheet = () => ({
                            getCell: () => ({ value: '', style: {} }),
                            getRow: () => ({ getCell: () => ({ value: '', style: {} }) }),
                            mergeCells: () => {},
                            columns: []
                        });
                        this.xlsx = {
                            writeBuffer: () => Promise.resolve(new ArrayBuffer(0))
                        };
                    }
                };
            }
        });
    });
})();
</script>

<!-- Core utilities already loaded above -->

<!-- Application components -->
<script src="js/components/application-controller.js"></script>

<!-- Main application -->
<script src="js/main.js"></script>
</body>
</html>